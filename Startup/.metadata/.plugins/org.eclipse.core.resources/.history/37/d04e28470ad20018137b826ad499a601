# coding=gbk
'''
Created on 2018年10月17日
@author: 钟以琛
'''

from socket import *

# create welcome socket for all requesting clients
serverPort = 12000
serverSocket = socket(AF_INET, SOCK_STREAM)
serverSocket.bind(('', serverPort))

# accepted clients dictionary
dic = {}

# listen to 'knocking to the welcome door'
serverSocket.listen(2)
print('The server is ready to receive...')

while True:
    # create connectionSocket for the single client after accepting
    connectionSocket, addr = serverSocket.accept()
    if (!dic.has_key(addr))
        dic[addr] = connectionSocket
    
    for clientSockt in dic.values():
        msgFrmC = clientSockt.recv(1024).decode()
        modifiedMessage = msgFrmC.upper()
        if (len(msgFrmC) > 0):
            print("Msg from client(%s): %s" % ((addr), msgFrmC))
            print('Response: ' + modifiedMessage)
        connectionSocket.send(modifiedMessage.encode())
    